{"Resources":{"StateMachine7d43c834":{"Type":"AWS::StepFunctions::StateMachine","Properties":{"Definition":{"Comment":"Orchestrate data transformation, ML (placeholder), and dashboard generation","StartAt":"TransformData","States":{"TransformData":{"Type":"Task","Resource":"${InvokeFunction_Resource_f52fe410}","Parameters":{"bucket":"${$.bucket}","key":"${$.key}"},"Next":"GenerateBasicDashboard","Catch":[{"ErrorEquals":["States.ALL"],"Next":"TransformationFailed"}]},"GenerateBasicDashboard":{"Type":"Task","Resource":"${InvokeFunction_Resource_87fae926}","Parameters":{"bucket":"${$.bucket}"},"Next":"MLProcessingSagemaker","Catch":[{"ErrorEquals":["States.ALL"],"Next":"DashboardFailed"}]},"MLProcessingSagemaker":{"Type":"Pass","Comment":"Pipeline for SageMaker ML processing","Next":"GenerateMlDashboard"},"GenerateMlDashboard":{"Type":"Task","Resource":"${InvokeFunction_Resource_87fae926}","Parameters":{"bucket":"${$.bucket}"},"End":true,"Catch":[{"ErrorEquals":["States.ALL"],"Next":"DashboardFailed"}]},"TransformationFailed":{"Type":"Fail","Cause":"Transformation failed","Error":"DataTransformationError"},"DashboardFailed":{"Type":"Fail","Cause":"Dashboard generation failed","Error":"DashboardGenerationError"}}},"DefinitionSubstitutions":{"InvokeFunction_Resource_f52fe410":"arn:aws:lambda:us-east-1:002573266567:function:vpp-transformation","InvokeFunction_Resource_87fae926":"arn:aws:lambda:us-east-1:002573266567:function:vpp-dashboard-generator"},"RoleArn":{"Fn::GetAtt":["Role09c12df3","Arn"]},"StateMachineName":"StateMachine7d43c834","StateMachineType":"STANDARD","EncryptionConfiguration":{"Type":"AWS_OWNED_KEY"},"LoggingConfiguration":{"Level":"OFF","IncludeExecutionData":false,"Destinations":[{"CloudWatchLogsLogGroup":{"LogGroupArn":""}}]}}},"Role09c12df3":{"Type":"AWS::IAM::Role","Properties":{"RoleName":"StepFunctions_IAM_ROLE_vpp-sf-state-machine891bcfb7","AssumeRolePolicyDocument":{"Version":"2012-10-17","Statement":[{"Effect":"Allow","Principal":{"Service":"states.amazonaws.com"},"Action":"sts:AssumeRole"}]},"MaxSessionDuration":3600}},"Policy1dce0d3c":{"Type":"AWS::IAM::RolePolicy","Properties":{"PolicyName":"XRayAccessPolicyde91b9d6","RoleName":{"Ref":"Role09c12df3"},"PolicyDocument":{"Version":"2012-10-17","Statement":[{"Effect":"Allow","Action":["xray:PutTraceSegments","xray:PutTelemetryRecords","xray:GetSamplingRules","xray:GetSamplingTargets"],"Resource":["*"]}]}}},"Policy82c96020":{"Type":"AWS::IAM::RolePolicy","Properties":{"PolicyName":"LambdaInvokeScopedAccessPolicy1b0f10e0","RoleName":{"Ref":"Role09c12df3"},"PolicyDocument":{"Version":"2012-10-17","Statement":[{"Effect":"Allow","Action":["lambda:InvokeFunction"],"Resource":["arn:aws:lambda:us-east-1:002573266567:function:vpp-dashboard-generator:*","arn:aws:lambda:us-east-1:002573266567:function:vpp-transformation:*"]},{"Effect":"Allow","Action":["lambda:InvokeFunction"],"Resource":["arn:aws:lambda:us-east-1:002573266567:function:vpp-dashboard-generator","arn:aws:lambda:us-east-1:002573266567:function:vpp-transformation"]}]}}}}}